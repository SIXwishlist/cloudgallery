"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var core_1 = require("@angular/core");
var router_1 = require("@angular/router");
var router_2 = require("nativescript-angular/router");
var dialogs = require("ui/dialogs");
var nativescript_exit_1 = require("nativescript-exit");
var Settings = require("application-settings");
var Util = /** @class */ (function () {
    function Util(router, route) {
        this.router = router;
        this.route = route;
        this.DEBUG = true;
        this.LOGTOSETTINGS = true;
        this.id = "UTIL_" + this.getTimestamp();
        this.loggerReset();
    }
    Util.prototype.getID = function () {
        return this.id;
    };
    Util.prototype.replaceAll = function (text, search, replacement) {
        return text.replace(new RegExp(search, 'g'), replacement);
    };
    Util.prototype.loggerReset = function () {
        var LOGAGE = Settings.getNumber("_LOGAGE");
        if (LOGAGE == null)
            LOGAGE = 0;
        if (LOGAGE >= 1) {
            LOGAGE = 0;
            Settings.setString("_LOG", "");
        }
        Settings.setNumber("_LOGAGE", LOGAGE + 1);
    };
    Util.prototype.loggerAppend = function (newLog) {
        var log = Settings.getString("_LOG");
        Settings.setString("_LOG", log + newLog);
    };
    Util.prototype.log = function (tag, obj) {
        if (this.DEBUG) {
            try {
                if (this.LOGTOSETTINGS) {
                    this.loggerAppend(tag + "\n");
                    this.loggerAppend(JSON.stringify(obj, null, 10) + "\n");
                }
                console.log(tag);
                console.log(JSON.stringify(obj, null, 10));
            }
            catch (ex) { }
        }
    };
    Util.prototype.sleep = function (time) {
        return new Promise(function (resolve) { return setTimeout(resolve, time); });
        /* Usage!
            util.sleep(500).then(() => {
                // Do something after the sleep!
            })
        */
    };
    Util.prototype.exit = function () {
        nativescript_exit_1.exit();
    };
    Util.prototype.navigate = function (to) {
        var path = [to];
        this.log("Navigate to", path);
        this.router.navigate(path, {
            transition: {
                name: "fadeIn",
                duration: 500,
                curve: "linear"
            }
        });
    };
    Util.prototype.navigatePage = function (to) {
        var path = ['root', { outlets: { rootoutlet: [to] } }];
        this.log("Navigate to", path);
        this.router.navigate(path, {
            transition: {
                name: "slideLeft",
                duration: 500,
                curve: "linear"
            }
        });
    };
    Util.prototype.navigateSection = function (to) {
        var path = ['base', { outlets: { baseoutlet: [to] } }];
        this.log("Navigate to", path);
        this.router.navigate(path, {
            transition: {
                name: "slideLeft",
                duration: 500,
                curve: "linear"
            }
        });
    };
    /* handle android back button */
    Util.prototype.navigateBack = function () {
        this.log("Navigate back", this.route.url);
        if (this.route.url != "/root/(rootoutlet:login)" &&
            this.route.url != "/base/(baseoutlet:home)") {
            this.router.back();
        }
        else {
            dialogs.confirm({
                title: "",
                message: "Sei sicuro di voler uscire dall'app?",
                okButtonText: "Esci",
                cancelButtonText: "Non ancora"
            }).then(function (confirm) {
                if (confirm)
                    nativescript_exit_1.exit();
            });
        }
    };
    Util.prototype.onTouchEffect = function (e) {
        if (e.type = "tap" && e.action == "down") {
            e.view.style.opacity = "0.5";
        }
        if (e.type = "tap" && e.action == "up") {
            e.view.style.opacity = "1";
        }
    };
    Util.prototype.getTimestamp = function () {
        var now = new Date();
        var year = now.getFullYear();
        var month = now.getMonth() + 1;
        var day = now.getDate();
        var hour = now.getHours();
        var minute = now.getMinutes();
        var second = now.getSeconds();
        var year_s = String("0000" + year).slice(-4);
        var month_s = String("00" + month).slice(-2);
        var day_s = String("00" + day).slice(-2);
        var hour_s = String("00" + hour).slice(-2);
        var minute_s = String("00" + minute).slice(-2);
        var second_s = String("00" + second).slice(-2);
        var timestamp = year_s + month_s + day_s + hour_s + minute_s + second_s;
        return timestamp;
    };
    Util.prototype.isValidEmail = function (email) {
        var re = /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
        return re.test(email);
    };
    Util = __decorate([
        core_1.Injectable(),
        __metadata("design:paramtypes", [router_2.RouterExtensions,
            router_1.Router])
    ], Util);
    return Util;
}());
exports.Util = Util;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXRpbC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbInV0aWwudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFDQSxzQ0FBMkM7QUFDM0MsMENBQXlDO0FBQ3pDLHNEQUErRDtBQUMvRCxvQ0FBc0M7QUFDdEMsdURBQXlDO0FBQ3pDLCtDQUFpRDtBQUlqRDtJQU1JLGNBQ1ksTUFBdUIsRUFDdkIsS0FBYTtRQURiLFdBQU0sR0FBTixNQUFNLENBQWlCO1FBQ3ZCLFVBQUssR0FBTCxLQUFLLENBQVE7UUFObEIsVUFBSyxHQUFHLElBQUksQ0FBQztRQUNiLGtCQUFhLEdBQUcsSUFBSSxDQUFDO1FBT3hCLElBQUksQ0FBQyxFQUFFLEdBQUcsT0FBTyxHQUFHLElBQUksQ0FBQyxZQUFZLEVBQUUsQ0FBQztRQUN4QyxJQUFJLENBQUMsV0FBVyxFQUFFLENBQUM7SUFDdkIsQ0FBQztJQUVNLG9CQUFLLEdBQVo7UUFDSSxNQUFNLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQztJQUNuQixDQUFDO0lBRU0seUJBQVUsR0FBakIsVUFBa0IsSUFBSSxFQUFFLE1BQU0sRUFBRSxXQUFXO1FBQ3ZDLE1BQU0sQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksTUFBTSxDQUFDLE1BQU0sRUFBRSxHQUFHLENBQUMsRUFBRSxXQUFXLENBQUMsQ0FBQztJQUM5RCxDQUFDO0lBRU0sMEJBQVcsR0FBbEI7UUFDSSxJQUFJLE1BQU0sR0FBRyxRQUFRLENBQUMsU0FBUyxDQUFDLFNBQVMsQ0FBQyxDQUFDO1FBQzNDLEVBQUUsQ0FBQSxDQUFDLE1BQU0sSUFBRSxJQUFJLENBQUM7WUFBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDO1FBQzVCLEVBQUUsQ0FBQSxDQUFDLE1BQU0sSUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ1gsTUFBTSxHQUFHLENBQUMsQ0FBQztZQUNYLFFBQVEsQ0FBQyxTQUFTLENBQUMsTUFBTSxFQUFFLEVBQUUsQ0FBQyxDQUFDO1FBQ25DLENBQUM7UUFD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QUFDLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFFL0MsSUFBSSxTQUFTLEdBQUcsTUFBTSxHQUFHLE9BQU8sR0FBRyxLQUFLLEdBQUcsTUFBTSxHQUFHLFFBQVEsR0FBRyxRQUFRLENBQUM7UUFDeEUsTUFBTSxDQUFDLFNBQVMsQ0FBQztJQUNyQixDQUFDO0lBRUQsMkJBQVksR0FBWixVQUFhLEtBQUs7UUFDZCxJQUFJLEVBQUUsR0FBRyx3SkFBd0osQ0FBQztRQUNsSyxNQUFNLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztJQUMxQixDQUFDO0lBNUpRLElBQUk7UUFEaEIsaUJBQVUsRUFBRTt5Q0FRVSx5QkFBZ0I7WUFDaEIsZUFBTTtPQVJoQixJQUFJLENBOEpoQjtJQUFELFdBQUM7Q0FBQSxBQTlKRCxJQThKQztBQTlKWSxvQkFBSSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIGFwcGxpY2F0aW9uIGZyb20gXCJhcHBsaWNhdGlvblwiO1xyXG5pbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IFJvdXRlciB9IGZyb20gXCJAYW5ndWxhci9yb3V0ZXJcIjtcclxuaW1wb3J0IHsgUm91dGVyRXh0ZW5zaW9ucyB9IGZyb20gXCJuYXRpdmVzY3JpcHQtYW5ndWxhci9yb3V0ZXJcIjtcclxuaW1wb3J0ICogYXMgZGlhbG9ncyBmcm9tIFwidWkvZGlhbG9nc1wiO1xyXG5pbXBvcnQgeyBleGl0IH0gZnJvbSAnbmF0aXZlc2NyaXB0LWV4aXQnO1xyXG5pbXBvcnQgKiBhcyBTZXR0aW5ncyBmcm9tIFwiYXBwbGljYXRpb24tc2V0dGluZ3NcIjtcclxuXHJcblxyXG5ASW5qZWN0YWJsZSgpXHJcbmV4cG9ydCBjbGFzcyBVdGlsIHtcclxuXHJcbiAgICBwdWJsaWMgREVCVUcgPSB0cnVlO1xyXG4gICAgcHVibGljIExPR1RPU0VUVElOR1MgPSB0cnVlO1xyXG4gICAgcHJpdmF0ZSBpZDtcclxuXHJcbiAgICBjb25zdHJ1Y3RvcihcclxuICAgICAgICBwcml2YXRlIHJvdXRlcjpSb3V0ZXJFeHRlbnNpb25zLCBcclxuICAgICAgICBwcml2YXRlIHJvdXRlOiBSb3V0ZXJcclxuICAgICkge1xyXG4gICAgICAgIHRoaXMuaWQgPSBcIlVUSUxfXCIgKyB0aGlzLmdldFRpbWVzdGFtcCgpOyAgIFxyXG4gICAgICAgIHRoaXMubG9nZ2VyUmVzZXQoKTsgICAgIFxyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBnZXRJRCgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5pZDtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgcmVwbGFjZUFsbCh0ZXh0LCBzZWFyY2gsIHJlcGxhY2VtZW50KSB7XHJcbiAgICAgICAgcmV0dXJuIHRleHQucmVwbGFjZShuZXcgUmVnRXhwKHNlYXJjaCwgJ2cnKSwgcmVwbGFjZW1lbnQpO1xyXG4gICAgfSBcclxuXHJcbiAgICBwdWJsaWMgbG9nZ2VyUmVzZXQoKSB7XHJcbiAgICAgICAgdmFyIExPR0FHRSA9IFNldHRpbmdzLmdldE51bWJlcihcIl9MT0dBR0VcIik7XHJcbiAgICAgICAgaWYoTE9HQUdFPT1udWxsKSBMT0dBR0UgPSAwO1xyXG4gICAgICAgIGlmKExPR0FHRT49MSkge1xyXG4gICAgICAgICAgICBMT0dBR0UgPSAwO1xyXG4gICAgICAgICAgICBTZXR0aW5ncy5zZXRTdHJpbmcoXCJfTE9HXCIsIFwiXCIpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBTZXR0aW5ncy5zZXROdW1iZXIoXCJfTE9HQUdFXCIsIExPR0FHRSsxKTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgbG9nZ2VyQXBwZW5kKG5ld0xvZykge1xyXG4gICAgICAgIHZhciBsb2cgPSBTZXR0aW5ncy5nZXRTdHJpbmcoXCJfTE9HXCIpO1xyXG4gICAgICAgIFNldHRpbmdzLnNldFN0cmluZyhcIl9MT0dcIiwgbG9nICsgbmV3TG9nKTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgbG9nKHRhZywgb2JqKSB7XHJcbiAgICAgICAgaWYodGhpcy5ERUJVRykge1xyXG4gICAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAgICAgaWYodGhpcy5MT0dUT1NFVFRJTkdTKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2dnZXJBcHBlbmQodGFnICsgXCJcXG5cIik7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2dnZXJBcHBlbmQoSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCAxMCkgKyBcIlxcblwiKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHRhZyk7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDEwKSk7XHJcbiAgICAgICAgICAgIH0gY2F0Y2goZXgpIHt9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBzbGVlcCh0aW1lKSB7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiBzZXRUaW1lb3V0KHJlc29sdmUsIHRpbWUpKTtcclxuXHJcbiAgICAgICAgLyogVXNhZ2UhXHJcbiAgICAgICAgICAgIHV0aWwuc2xlZXAoNTAwKS50aGVuKCgpID0+IHtcclxuICAgICAgICAgICAgICAgIC8vIERvIHNvbWV0aGluZyBhZnRlciB0aGUgc2xlZXAhXHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgKi9cclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgZXhpdCgpIHtcclxuICAgICAgICBleGl0KCk7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIG5hdmlnYXRlKHRvKSB7XHJcbiAgICAgICAgbGV0IHBhdGggPSBbdG9dO1xyXG4gICAgICAgIHRoaXMubG9nKFwiTmF2aWdhdGUgdG9cIiwgcGF0aCk7XHJcbiAgICAgICAgdGhpcy5yb3V0ZXIubmF2aWdhdGUocGF0aCxcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgdHJhbnNpdGlvbjoge1xyXG4gICAgICAgICAgICAgICAgICAgIG5hbWU6IFwiZmFkZUluXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgZHVyYXRpb246IDUwMCxcclxuICAgICAgICAgICAgICAgICAgICBjdXJ2ZTogXCJsaW5lYXJcIlxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgKTsgICAgICAgICAgXHJcbiAgICB9XHJcbiAgICBcclxuICAgIHB1YmxpYyBuYXZpZ2F0ZVBhZ2UodG8pIHtcclxuICAgICAgICBsZXQgcGF0aCA9IFsncm9vdCcsIHsgb3V0bGV0czogeyByb290b3V0bGV0OiBbdG9dIH0gfSBdO1xyXG4gICAgICAgIHRoaXMubG9nKFwiTmF2aWdhdGUgdG9cIiwgcGF0aCk7XHJcbiAgICAgICAgdGhpcy5yb3V0ZXIubmF2aWdhdGUocGF0aCxcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgdHJhbnNpdGlvbjoge1xyXG4gICAgICAgICAgICAgICAgICAgIG5hbWU6IFwic2xpZGVMZWZ0XCIsXHJcbiAgICAgICAgICAgICAgICAgICAgZHVyYXRpb246IDUwMCxcclxuICAgICAgICAgICAgICAgICAgICBjdXJ2ZTogXCJsaW5lYXJcIlxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgKTsgICAgICAgICAgXHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIG5hdmlnYXRlU2VjdGlvbih0bykgeyBcclxuICAgICAgICBsZXQgcGF0aCA9IFsnYmFzZScsIHsgb3V0bGV0czogeyBiYXNlb3V0bGV0OiBbdG9dIH0gfSBdO1xyXG4gICAgICAgIHRoaXMubG9nKFwiTmF2aWdhdGUgdG9cIiwgcGF0aCk7XHJcbiAgICAgICAgdGhpcy5yb3V0ZXIubmF2aWdhdGUocGF0aCxcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgdHJhbnNpdGlvbjoge1xyXG4gICAgICAgICAgICAgICAgICAgIG5hbWU6IFwic2xpZGVMZWZ0XCIsXHJcbiAgICAgICAgICAgICAgICAgICAgZHVyYXRpb246IDUwMCxcclxuICAgICAgICAgICAgICAgICAgICBjdXJ2ZTogXCJsaW5lYXJcIlxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgKTsgICAgICAgICAgXHJcbiAgICB9XHJcblxyXG4gICAgLyogaGFuZGxlIGFuZHJvaWQgYmFjayBidXR0b24gKi9cclxuICAgIHB1YmxpYyBuYXZpZ2F0ZUJhY2soKSB7XHJcbiAgICAgICAgdGhpcy5sb2coXCJOYXZpZ2F0ZSBiYWNrXCIsIHRoaXMucm91dGUudXJsKTtcclxuICAgICAgICBpZih0aGlzLnJvdXRlLnVybCE9XCIvcm9vdC8ocm9vdG91dGxldDpsb2dpbilcIiAmJlxyXG4gICAgICAgICAgICB0aGlzLnJvdXRlLnVybCE9XCIvYmFzZS8oYmFzZW91dGxldDpob21lKVwiKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnJvdXRlci5iYWNrKCk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgZGlhbG9ncy5jb25maXJtKHtcclxuICAgICAgICAgICAgICAgIHRpdGxlOiBcIlwiLFxyXG4gICAgICAgICAgICAgICAgbWVzc2FnZTogXCJTZWkgc2ljdXJvIGRpIHZvbGVyIHVzY2lyZSBkYWxsJ2FwcD9cIixcclxuICAgICAgICAgICAgICAgIG9rQnV0dG9uVGV4dDogXCJFc2NpXCIsXHJcbiAgICAgICAgICAgICAgICBjYW5jZWxCdXR0b25UZXh0OiBcIk5vbiBhbmNvcmFcIlxyXG4gICAgICAgICAgICB9KS50aGVuKGNvbmZpcm0gPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYoY29uZmlybSkgZXhpdCgpO1xyXG4gICAgICAgICAgICB9KTsgICAgICAgICAgICBcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIG9uVG91Y2hFZmZlY3QoZSkge1xyXG4gICAgICAgIGlmKGUudHlwZT1cInRhcFwiICYmIGUuYWN0aW9uPT1cImRvd25cIikgeyBcclxuICAgICAgICAgICAgZS52aWV3LnN0eWxlLm9wYWNpdHkgPSBcIjAuNVwiOyBcclxuICAgICAgICB9IFxyXG4gICAgICAgIGlmKGUudHlwZT1cInRhcFwiICYmIGUuYWN0aW9uPT1cInVwXCIpIHsgXHJcbiAgICAgICAgICAgIGUudmlldy5zdHlsZS5vcGFjaXR5ID0gXCIxXCI7IFxyXG4gICAgICAgIH0gICAgICAgXHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGdldFRpbWVzdGFtcCgpIHtcclxuICAgICAgICB2YXIgbm93ICAgICA9IG5ldyBEYXRlKCk7IFxyXG4gICAgICAgIHZhciB5ZWFyICAgID0gbm93LmdldEZ1bGxZZWFyKCk7XHJcbiAgICAgICAgdmFyIG1vbnRoICAgPSBub3cuZ2V0TW9udGgoKSsxOyBcclxuICAgICAgICB2YXIgZGF5ICAgICA9IG5vdy5nZXREYXRlKCk7XHJcbiAgICAgICAgdmFyIGhvdXIgICAgPSBub3cuZ2V0SG91cnMoKTtcclxuICAgICAgICB2YXIgbWludXRlICA9IG5vdy5nZXRNaW51dGVzKCk7XHJcbiAgICAgICAgdmFyIHNlY29uZCAgPSBub3cuZ2V0U2Vjb25kcygpOyBcclxuXHJcbiAgICAgICAgbGV0IHllYXJfcyA9IFN0cmluZyhcIjAwMDBcIiArIHllYXIpLnNsaWNlKC00KTtcclxuICAgICAgICBsZXQgbW9udGhfcyA9IFN0cmluZyhcIjAwXCIgKyBtb250aCkuc2xpY2UoLTIpO1xyXG4gICAgICAgIGxldCBkYXlfcyA9IFN0cmluZyhcIjAwXCIgKyBkYXkpLnNsaWNlKC0yKTtcclxuICAgICAgICBsZXQgaG91cl9zID0gU3RyaW5nKFwiMDBcIiArIGhvdXIpLnNsaWNlKC0yKTtcclxuICAgICAgICBsZXQgbWludXRlX3MgPSBTdHJpbmcoXCIwMFwiICsgbWludXRlKS5zbGljZSgtMik7XHJcbiAgICAgICAgbGV0IHNlY29uZF9zID0gU3RyaW5nKFwiMDBcIiArIHNlY29uZCkuc2xpY2UoLTIpO1xyXG5cclxuICAgICAgICB2YXIgdGltZXN0YW1wID0geWVhcl9zICsgbW9udGhfcyArIGRheV9zICsgaG91cl9zICsgbWludXRlX3MgKyBzZWNvbmRfczsgICBcclxuICAgICAgICByZXR1cm4gdGltZXN0YW1wO1xyXG4gICAgfSAgICAgICAgIFxyXG5cclxuICAgIGlzVmFsaWRFbWFpbChlbWFpbCkge1xyXG4gICAgICAgIHZhciByZSA9IC9eKChbXjw+KClcXFtcXF1cXFxcLiw7Olxcc0BcIl0rKFxcLltePD4oKVxcW1xcXVxcXFwuLDs6XFxzQFwiXSspKil8KFwiLitcIikpQCgoXFxbWzAtOV17MSwzfVxcLlswLTldezEsM31cXC5bMC05XXsxLDN9XFwuWzAtOV17MSwzfV0pfCgoW2EtekEtWlxcLTAtOV0rXFwuKStbYS16QS1aXXsyLH0pKSQvO1xyXG4gICAgICAgIHJldHVybiByZS50ZXN0KGVtYWlsKTtcclxuICAgIH0gICAgXHJcblxyXG59Il19