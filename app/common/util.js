"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var core_1 = require("@angular/core");
var router_1 = require("@angular/router");
var router_2 = require("nativescript-angular/router");
var dialogs = require("ui/dialogs");
var nativescript_exit_1 = require("nativescript-exit");
var Settings = require("application-settings");
var Util = /** @class */ (function () {
    function Util(router, route) {
        this.router = router;
        this.route = route;
        this.DEBUG = true;
        this.LOGTOSETTINGS = true;
        this.id = "UTIL_" + this.getTimestamp();
        this.loggerReset();
    }
    Util.prototype.getID = function () {
        return this.id;
    };
    Util.prototype.replaceAll = function (text, search, replacement) {
        return text.replace(new RegExp(search, 'g'), replacement);
    };
    Util.prototype.loggerReset = function () {
        var LOGAGE = Settings.getNumber("_LOGAGE");
        if (LOGAGE == null)
            LOGAGE = 0;
        if (LOGAGE >= 1) {
            LOGAGE = 0;
            Settings.setString("_LOG", "");
        }
        Settings.setNumber("_LOGAGE", LOGAGE + 1);
    };
    Util.prototype.loggerAppend = function (newLog) {
        var log = Settings.getString("_LOG");
        Settings.setString("_LOG", log + newLog);
    };
    Util.prototype.log = function (tag, obj) {
        if (this.DEBUG) {
            try {
                if (this.LOGTOSETTINGS) {
                    this.loggerAppend(tag + "\n");
                    if (obj != null)
                        this.loggerAppend(JSON.stringify(obj, null, 10) + "\n");
                }
                console.log(tag);
                if (obj != null)
                    console.log(JSON.stringify(obj, null, 10));
            }
            catch (ex) { }
        }
    };
    Util.prototype.sleep = function (time) {
        return new Promise(function (resolve) { return setTimeout(resolve, time); });
        /* Usage!
            util.sleep(500).then(() => {
                // Do something after the sleep!
            })
        */
    };
    Util.prototype.exit = function () {
        nativescript_exit_1.exit();
    };
    Util.prototype.navigate = function (to) {
        var path = [to];
        this.log("Navigate to", path);
        this.router.navigate(path, {
            transition: {
                name: "fadeIn",
                duration: 500,
                curve: "linear"
            }
        });
    };
    Util.prototype.navigatePage = function (to) {
        var path = ['root', { outlets: { rootoutlet: [to] } }];
        this.log("Navigate to", path);
        this.router.navigate(path, {
            transition: {
                name: "slideLeft",
                duration: 500,
                curve: "linear"
            }
        });
    };
    Util.prototype.navigateSection = function (to) {
        var path = ['base', { outlets: { baseoutlet: [to] } }];
        this.log("Navigate to", path);
        this.router.navigate(path, {
            transition: {
                name: "slideLeft",
                duration: 500,
                curve: "linear"
            }
        });
    };
    Util.prototype.getCurrentRoute = function () {
        return this.route.url;
    };
    /* handle android back button */
    Util.prototype.navigateBack = function () {
        if (this.route.url != "/root/(rootoutlet:login)" &&
            this.route.url != "/base/(baseoutlet:home)") {
            this.router.back();
        }
        else {
            dialogs.confirm({
                title: "",
                message: "Sei sicuro di voler uscire dall'app?",
                okButtonText: "Esci",
                cancelButtonText: "Non ancora"
            }).then(function (confirm) {
                if (confirm)
                    nativescript_exit_1.exit();
            });
        }
    };
    Util.prototype.onTouchEffect = function (e) {
        if (e.type = "tap" && e.action == "down") {
            e.view.style.opacity = "0.5";
        }
        if (e.type = "tap" && e.action == "up") {
            e.view.style.opacity = "1";
        }
    };
    Util.prototype.getTimestamp = function () {
        var now = new Date();
        var year = now.getFullYear();
        var month = now.getMonth() + 1;
        var day = now.getDate();
        var hour = now.getHours();
        var minute = now.getMinutes();
        var second = now.getSeconds();
        var year_s = String("0000" + year).slice(-4);
        var month_s = String("00" + month).slice(-2);
        var day_s = String("00" + day).slice(-2);
        var hour_s = String("00" + hour).slice(-2);
        var minute_s = String("00" + minute).slice(-2);
        var second_s = String("00" + second).slice(-2);
        var timestamp = year_s + month_s + day_s + hour_s + minute_s + second_s;
        return timestamp;
    };
    Util.prototype.isValidEmail = function (email) {
        var re = /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
        return re.test(email);
    };
    Util = __decorate([
        core_1.Injectable(),
        __metadata("design:paramtypes", [router_2.RouterExtensions,
            router_1.Router])
    ], Util);
    return Util;
}());
exports.Util = Util;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXRpbC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbInV0aWwudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFDQSxzQ0FBMkM7QUFDM0MsMENBQXlDO0FBQ3pDLHNEQUErRDtBQUMvRCxvQ0FBc0M7QUFDdEMsdURBQXlDO0FBQ3pDLCtDQUFpRDtBQUlqRDtJQU1JLGNBQ1ksTUFBdUIsRUFDdkIsS0FBYTtRQURiLFdBQU0sR0FBTixNQUFNLENBQWlCO1FBQ3ZCLFVBQUssR0FBTCxLQUFLLENBQVE7UUFObEIsVUFBSyxHQUFHLElBQUksQ0FBQztRQUNiLGtCQUFhLEdBQUcsSUFBSSxDQUFDO1FBT3hCLElBQUksQ0FBQyxFQUFFLEdBQUcsT0FBTyxHQUFHLElBQUksQ0FBQyxZQUFZLEVBQUUsQ0FBQztRQUN4QyxJQUFJLENBQUMsV0FBVyxFQUFFLENBQUM7SUFDdkIsQ0FBQztJQUVNLG9CQUFLLEdBQVo7UUFDSSxNQUFNLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQztJQUNuQixDQUFDO0lBRU0seUJBQVUsR0FBakIsVUFBa0IsSUFBSSxFQUFFLE1BQU0sRUFBRSxXQUFXO1FBQ3ZDLE1BQU0sQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksTUFBTSxDQUFDLE1BQU0sRUFBRSxHQUFHLENBQUMsRUFBRSxXQUFXLENBQUMsQ0FBQztJQUM5RCxDQUFDO0lBRU0sMEJBQVcsR0FBbEI7UUFDSSxJQUFJLE1BQU0sR0FBRyxRQUFRLENBQUMsU0FBUyxDQUFDLFNBQVMsQ0FBQyxDQUFDO1FBQzNDLEVBQUUsQ0FBQSxDQUFDLE1BQU0sSUFBRSxJQUFJLENBQUM7WUFBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDO1FBQzVCLEVBQUUsQ0FBQSxDQUFDLE1BQU0sSUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ1gsTUFBTSxHQUFHLENBQUMsQ0FBQztZQUNYLFFBQVEsQ0FBQyxTQUFTLENBQUMsTUFBTSxFQUFFLEVBQUUsQ0FBQyxDQUFDO1FBQ25DLENBQUM7UUFD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QyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQy9DLElBQUksUUFBUSxHQUFHLE1BQU0sQ0FBQyxJQUFJLEdBQUcsTUFBTSxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFFL0MsSUFBSSxTQUFTLEdBQUcsTUFBTSxHQUFHLE9BQU8sR0FBRyxLQUFLLEdBQUcsTUFBTSxHQUFHLFFBQVEsR0FBRyxRQUFRLENBQUM7UUFDeEUsTUFBTSxDQUFDLFNBQVMsQ0FBQztJQUNyQixDQUFDO0lBRUQsMkJBQVksR0FBWixVQUFhLEtBQUs7UUFDZCxJQUFJLEVBQUUsR0FBRyx3SkFBd0osQ0FBQztRQUNsSyxNQUFNLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztJQUMxQixDQUFDO0lBL0pRLElBQUk7UUFEaEIsaUJBQVUsRUFBRTt5Q0FRVSx5QkFBZ0I7WUFDaEIsZUFBTTtPQVJoQixJQUFJLENBaUtoQjtJQUFELFdBQUM7Q0FBQSxBQWpLRCxJQWlLQztBQWpLWSxvQkFBSSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIGFwcGxpY2F0aW9uIGZyb20gXCJhcHBsaWNhdGlvblwiO1xyXG5pbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IFJvdXRlciB9IGZyb20gXCJAYW5ndWxhci9yb3V0ZXJcIjtcclxuaW1wb3J0IHsgUm91dGVyRXh0ZW5zaW9ucyB9IGZyb20gXCJuYXRpdmVzY3JpcHQtYW5ndWxhci9yb3V0ZXJcIjtcclxuaW1wb3J0ICogYXMgZGlhbG9ncyBmcm9tIFwidWkvZGlhbG9nc1wiO1xyXG5pbXBvcnQgeyBleGl0IH0gZnJvbSAnbmF0aXZlc2NyaXB0LWV4aXQnO1xyXG5pbXBvcnQgKiBhcyBTZXR0aW5ncyBmcm9tIFwiYXBwbGljYXRpb24tc2V0dGluZ3NcIjtcclxuXHJcblxyXG5ASW5qZWN0YWJsZSgpXHJcbmV4cG9ydCBjbGFzcyBVdGlsIHtcclxuXHJcbiAgICBwdWJsaWMgREVCVUcgPSB0cnVlO1xyXG4gICAgcHVibGljIExPR1RPU0VUVElOR1MgPSB0cnVlO1xyXG4gICAgcHJpdmF0ZSBpZDtcclxuXHJcbiAgICBjb25zdHJ1Y3RvcihcclxuICAgICAgICBwcml2YXRlIHJvdXRlcjpSb3V0ZXJFeHRlbnNpb25zLCBcclxuICAgICAgICBwcml2YXRlIHJvdXRlOiBSb3V0ZXJcclxuICAgICkge1xyXG4gICAgICAgIHRoaXMuaWQgPSBcIlVUSUxfXCIgKyB0aGlzLmdldFRpbWVzdGFtcCgpOyAgIFxyXG4gICAgICAgIHRoaXMubG9nZ2VyUmVzZXQoKTsgICAgIFxyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBnZXRJRCgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5pZDtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgcmVwbGFjZUFsbCh0ZXh0LCBzZWFyY2gsIHJlcGxhY2VtZW50KSB7XHJcbiAgICAgICAgcmV0dXJuIHRleHQucmVwbGFjZShuZXcgUmVnRXhwKHNlYXJjaCwgJ2cnKSwgcmVwbGFjZW1lbnQpO1xyXG4gICAgfSBcclxuXHJcbiAgICBwdWJsaWMgbG9nZ2VyUmVzZXQoKSB7XHJcbiAgICAgICAgdmFyIExPR0FHRSA9IFNldHRpbmdzLmdldE51bWJlcihcIl9MT0dBR0VcIik7XHJcbiAgICAgICAgaWYoTE9HQUdFPT1udWxsKSBMT0dBR0UgPSAwO1xyXG4gICAgICAgIGlmKExPR0FHRT49MSkge1xyXG4gICAgICAgICAgICBMT0dBR0UgPSAwO1xyXG4gICAgICAgICAgICBTZXR0aW5ncy5zZXRTdHJpbmcoXCJfTE9HXCIsIFwiXCIpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBTZXR0aW5ncy5zZXROdW1iZXIoXCJfTE9HQUdFXCIsIExPR0FHRSsxKTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgbG9nZ2VyQXBwZW5kKG5ld0xvZykge1xyXG4gICAgICAgIHZhciBsb2cgPSBTZXR0aW5ncy5nZXRTdHJpbmcoXCJfTE9HXCIpO1xyXG4gICAgICAgIFNldHRpbmdzLnNldFN0cmluZyhcIl9MT0dcIiwgbG9nICsgbmV3TG9nKTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgbG9nKHRhZywgb2JqKSB7XHJcbiAgICAgICAgaWYodGhpcy5ERUJVRykge1xyXG4gICAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAgICAgaWYodGhpcy5MT0dUT1NFVFRJTkdTKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2dnZXJBcHBlbmQodGFnICsgXCJcXG5cIik7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYob2JqIT1udWxsKSB0aGlzLmxvZ2dlckFwcGVuZChKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDEwKSArIFwiXFxuXCIpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2codGFnKTtcclxuICAgICAgICAgICAgICAgIGlmKG9iaiE9bnVsbCkgY29uc29sZS5sb2coSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCAxMCkpO1xyXG4gICAgICAgICAgICB9IGNhdGNoKGV4KSB7fVxyXG4gICAgICAgIH1cclxuICAgIH0gICBcclxuXHJcbiAgICBwdWJsaWMgc2xlZXAodGltZSkge1xyXG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gc2V0VGltZW91dChyZXNvbHZlLCB0aW1lKSk7XHJcblxyXG4gICAgICAgIC8qIFVzYWdlIVxyXG4gICAgICAgICAgICB1dGlsLnNsZWVwKDUwMCkudGhlbigoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAvLyBEbyBzb21ldGhpbmcgYWZ0ZXIgdGhlIHNsZWVwIVxyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICovXHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGV4aXQoKSB7XHJcbiAgICAgICAgZXhpdCgpO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBuYXZpZ2F0ZSh0bykge1xyXG4gICAgICAgIGxldCBwYXRoID0gW3RvXTtcclxuICAgICAgICB0aGlzLmxvZyhcIk5hdmlnYXRlIHRvXCIsIHBhdGgpO1xyXG4gICAgICAgIHRoaXMucm91dGVyLm5hdmlnYXRlKHBhdGgsXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHRyYW5zaXRpb246IHtcclxuICAgICAgICAgICAgICAgICAgICBuYW1lOiBcImZhZGVJblwiLFxyXG4gICAgICAgICAgICAgICAgICAgIGR1cmF0aW9uOiA1MDAsXHJcbiAgICAgICAgICAgICAgICAgICAgY3VydmU6IFwibGluZWFyXCJcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICk7ICAgICAgICAgIFxyXG4gICAgfVxyXG4gICAgXHJcbiAgICBwdWJsaWMgbmF2aWdhdGVQYWdlKHRvKSB7XHJcbiAgICAgICAgbGV0IHBhdGggPSBbJ3Jvb3QnLCB7IG91dGxldHM6IHsgcm9vdG91dGxldDogW3RvXSB9IH0gXTtcclxuICAgICAgICB0aGlzLmxvZyhcIk5hdmlnYXRlIHRvXCIsIHBhdGgpO1xyXG4gICAgICAgIHRoaXMucm91dGVyLm5hdmlnYXRlKHBhdGgsXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHRyYW5zaXRpb246IHtcclxuICAgICAgICAgICAgICAgICAgICBuYW1lOiBcInNsaWRlTGVmdFwiLFxyXG4gICAgICAgICAgICAgICAgICAgIGR1cmF0aW9uOiA1MDAsXHJcbiAgICAgICAgICAgICAgICAgICAgY3VydmU6IFwibGluZWFyXCJcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICk7ICAgICAgICAgIFxyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBuYXZpZ2F0ZVNlY3Rpb24odG8pIHsgXHJcbiAgICAgICAgbGV0IHBhdGggPSBbJ2Jhc2UnLCB7IG91dGxldHM6IHsgYmFzZW91dGxldDogW3RvXSB9IH0gXTtcclxuICAgICAgICB0aGlzLmxvZyhcIk5hdmlnYXRlIHRvXCIsIHBhdGgpO1xyXG4gICAgICAgIHRoaXMucm91dGVyLm5hdmlnYXRlKHBhdGgsXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHRyYW5zaXRpb246IHtcclxuICAgICAgICAgICAgICAgICAgICBuYW1lOiBcInNsaWRlTGVmdFwiLFxyXG4gICAgICAgICAgICAgICAgICAgIGR1cmF0aW9uOiA1MDAsXHJcbiAgICAgICAgICAgICAgICAgICAgY3VydmU6IFwibGluZWFyXCJcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICk7ICAgICAgICAgIFxyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBnZXRDdXJyZW50Um91dGUoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMucm91dGUudXJsO1xyXG4gICAgfVxyXG5cclxuICAgIC8qIGhhbmRsZSBhbmRyb2lkIGJhY2sgYnV0dG9uICovXHJcbiAgICBwdWJsaWMgbmF2aWdhdGVCYWNrKCkge1xyXG4gICAgICAgIGlmKHRoaXMucm91dGUudXJsIT1cIi9yb290Lyhyb290b3V0bGV0OmxvZ2luKVwiICYmXHJcbiAgICAgICAgICAgIHRoaXMucm91dGUudXJsIT1cIi9iYXNlLyhiYXNlb3V0bGV0OmhvbWUpXCIpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMucm91dGVyLmJhY2soKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBkaWFsb2dzLmNvbmZpcm0oe1xyXG4gICAgICAgICAgICAgICAgdGl0bGU6IFwiXCIsXHJcbiAgICAgICAgICAgICAgICBtZXNzYWdlOiBcIlNlaSBzaWN1cm8gZGkgdm9sZXIgdXNjaXJlIGRhbGwnYXBwP1wiLFxyXG4gICAgICAgICAgICAgICAgb2tCdXR0b25UZXh0OiBcIkVzY2lcIixcclxuICAgICAgICAgICAgICAgIGNhbmNlbEJ1dHRvblRleHQ6IFwiTm9uIGFuY29yYVwiXHJcbiAgICAgICAgICAgIH0pLnRoZW4oY29uZmlybSA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZihjb25maXJtKSBleGl0KCk7XHJcbiAgICAgICAgICAgIH0pOyAgICAgICAgICAgIFxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgb25Ub3VjaEVmZmVjdChlKSB7XHJcbiAgICAgICAgaWYoZS50eXBlPVwidGFwXCIgJiYgZS5hY3Rpb249PVwiZG93blwiKSB7IFxyXG4gICAgICAgICAgICBlLnZpZXcuc3R5bGUub3BhY2l0eSA9IFwiMC41XCI7IFxyXG4gICAgICAgIH0gXHJcbiAgICAgICAgaWYoZS50eXBlPVwidGFwXCIgJiYgZS5hY3Rpb249PVwidXBcIikgeyBcclxuICAgICAgICAgICAgZS52aWV3LnN0eWxlLm9wYWNpdHkgPSBcIjFcIjsgXHJcbiAgICAgICAgfSAgICAgICBcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgZ2V0VGltZXN0YW1wKCkge1xyXG4gICAgICAgIHZhciBub3cgICAgID0gbmV3IERhdGUoKTsgXHJcbiAgICAgICAgdmFyIHllYXIgICAgPSBub3cuZ2V0RnVsbFllYXIoKTtcclxuICAgICAgICB2YXIgbW9udGggICA9IG5vdy5nZXRNb250aCgpKzE7IFxyXG4gICAgICAgIHZhciBkYXkgICAgID0gbm93LmdldERhdGUoKTtcclxuICAgICAgICB2YXIgaG91ciAgICA9IG5vdy5nZXRIb3VycygpO1xyXG4gICAgICAgIHZhciBtaW51dGUgID0gbm93LmdldE1pbnV0ZXMoKTtcclxuICAgICAgICB2YXIgc2Vjb25kICA9IG5vdy5nZXRTZWNvbmRzKCk7IFxyXG5cclxuICAgICAgICBsZXQgeWVhcl9zID0gU3RyaW5nKFwiMDAwMFwiICsgeWVhcikuc2xpY2UoLTQpO1xyXG4gICAgICAgIGxldCBtb250aF9zID0gU3RyaW5nKFwiMDBcIiArIG1vbnRoKS5zbGljZSgtMik7XHJcbiAgICAgICAgbGV0IGRheV9zID0gU3RyaW5nKFwiMDBcIiArIGRheSkuc2xpY2UoLTIpO1xyXG4gICAgICAgIGxldCBob3VyX3MgPSBTdHJpbmcoXCIwMFwiICsgaG91cikuc2xpY2UoLTIpO1xyXG4gICAgICAgIGxldCBtaW51dGVfcyA9IFN0cmluZyhcIjAwXCIgKyBtaW51dGUpLnNsaWNlKC0yKTtcclxuICAgICAgICBsZXQgc2Vjb25kX3MgPSBTdHJpbmcoXCIwMFwiICsgc2Vjb25kKS5zbGljZSgtMik7XHJcblxyXG4gICAgICAgIHZhciB0aW1lc3RhbXAgPSB5ZWFyX3MgKyBtb250aF9zICsgZGF5X3MgKyBob3VyX3MgKyBtaW51dGVfcyArIHNlY29uZF9zOyAgIFxyXG4gICAgICAgIHJldHVybiB0aW1lc3RhbXA7XHJcbiAgICB9ICAgICAgICAgXHJcblxyXG4gICAgaXNWYWxpZEVtYWlsKGVtYWlsKSB7XHJcbiAgICAgICAgdmFyIHJlID0gL14oKFtePD4oKVxcW1xcXVxcXFwuLDs6XFxzQFwiXSsoXFwuW148PigpXFxbXFxdXFxcXC4sOzpcXHNAXCJdKykqKXwoXCIuK1wiKSlAKChcXFtbMC05XXsxLDN9XFwuWzAtOV17MSwzfVxcLlswLTldezEsM31cXC5bMC05XXsxLDN9XSl8KChbYS16QS1aXFwtMC05XStcXC4pK1thLXpBLVpdezIsfSkpJC87XHJcbiAgICAgICAgcmV0dXJuIHJlLnRlc3QoZW1haWwpO1xyXG4gICAgfSAgICBcclxuXHJcbn0iXX0=